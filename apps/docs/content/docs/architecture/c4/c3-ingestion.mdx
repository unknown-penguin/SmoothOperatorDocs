---
title: c3 - ingestion
description: Component diagram for the Ingestion Service (MQTT → Kafka).
---

## Ingestion Service — Components

<Diagram lang="mermaid" chart={`
flowchart TD
  subgraph IngestSvc["Ingestion Service\n(Go)"]
    MQTTClient["MQTT Subscriber\n(topic subscriptions, TLS)"]
    Normalizer["Normalizer & Schema Validator\n(topic -> canonical schema)"]
    ContextMerger["Context Merger\n(join external context)"]
    KafkaProd["Kafka Producer\n(telemetry.raw.v1, telemetry.context.v1)"]
    HTTPGRPC["HTTP/gRPC Ingress\n(receive RaceProvider data)"]
    Config["Config & Backoff\n(retries, rate limit)"]
    Health["Health & Metrics"]
  end

  MQTTBroker["MQTT Broker\ninfra"]
  Kafka["Kafka Cluster\ninfra"]

  MQTTBroker -->|push messages| MQTTClient
  HTTPGRPC -->|receive| ContextMerger
  MQTTClient --> Normalizer
  Normalizer --> ContextMerger
  ContextMerger --> KafkaProd
  KafkaProd -->|produce| Kafka
  Health -.->|metrics| MQTTBroker

  class IngestSvc go;
  class MQTTBroker,Kafka infra;
  classDef go fill:#0ea5e9,stroke:#0369a1,color:#ffffff;
  classDef infra fill:#374151,stroke:#111827,color:#ffffff;
  `} />

Notes: lightweight, horizontally scalable; keeps schema and mapping logic minimal; handles noisy devices and backpressure.
