---
title: ECU Telemetry Simulator
description: Component-level overview of the Go-based ECU telemetry simulator used to publish synthetic race car telemetry.
---

## ECU Telemetry Simulator (Go)

The simulator produces realistic, controllable telemetry streams for development, testing, and performance validation. It publishes MQTT messages following the same topic semantics as live race cars (e.g. `telemetry/<carId>/<sessionId>/...`).

### Goals
- Deterministic & stochastic signal generation (pace, wear, RPM, temperatures)
- Failure & anomaly injection for alert pipeline validation
- Low-latency MQTT publishing with configurable QoS / reconnect policies
- Scriptable scenarios and scheduled runs
- Observability (metrics, structured logs, health checks)

<Diagram lang="mermaid" chart={`
flowchart TD
  %% ============================================
  %% ECU Telemetry Simulator Components (Go)
  %% ============================================

  subgraph Sim["ECU Telemetry Simulator (Go)"]
    direction TB

    subgraph Profiles["Signal Profiles"]
      Laps["Lap/sector generators\npace, tyre wear"]
      Engine["Engine curves\nRPM, temps, torque"]
      Failures["Failure Injection\nnoise, drop, spikes"]
    end

    subgraph Publisher["MQTT Publisher"]
      TopicMap["Topic Mapper\ntelemetry/* by car/session"]
      QoS["QoS / Retain Settings\nTLS config"]
      Backoff["Reconnect & Backoff"]
    end

    subgraph Control["Control"]
      CLI["CLI / HTTP Control\nstart / stop, seed"]
      Schedules["Scenarios / Schedules\nprebaked runs"]
    end

    subgraph Obs["Observability"]
      Metrics["Prometheus\nmsgs/sec, jitter"]
      Logs["Structured logs\nLoki"]
      Health["/health"]
    end
  end

  MQTT["MQTT Broker (infra)"]

  %% Flows
  Profiles --> TopicMap --> QoS --> MQTT
  Failures --> TopicMap
  Backoff --> MQTT
  CLI --> Schedules --> Profiles

  %% Observability
  TopicMap -.-> Metrics
  Health -.-> MQTT

  %% Styling
  classDef go fill:#0ea5e9,stroke:#0369a1,color:#ffffff;
  classDef infra fill:#374151,stroke:#111827,color:#ffffff;

  class Sim,Profiles,Laps,Engine,Failures,Publisher,TopicMap,QoS,Backoff,Control,CLI,Schedules,Obs,Metrics,Logs,Health go;
  class MQTT infra;
`} />

### Key Configuration
| Aspect | Purpose | Example |
|--------|---------|---------|
| Topic Format | Align with production ingestion | `telemetry.raw.v1` / `telemetry.context.v1` |
| QoS | Delivery guarantees trade-off | 0 (benchmarks), 1 (normal), 2 (edge cases) |
| Failure Modes | Stress alerting & resilience | random drop %, spike amplitude, latency injection |
| Scenario Schedules | Repeatable regression runs | Warmup → Race Pace → Degradation |
| Health Probe | Container readiness | `/health` (200 OK) |

### Extending
1. Add a new profile module under `profiles/` implementing a generator interface.
2. Register the profile with the scenario scheduler.
3. Expose configuration flags via CLI / HTTP.
4. Add metrics (counter/gauge/histogram) to Prometheus export.

### Observability Notes
- Metrics collected: publish rate, message size bytes, jitter, reconnect count.
- Structured logs includes trace IDs to correlate with ingestion and processing.
- Health endpoint can optionally verify connectivity to MQTT before reporting READY.

### Next Improvements
- Add trace instrumentation (OpenTelemetry spans around publish batches)
- Pluggable noise strategies (Gaussian, Perlin, domain-specific spikes)
- Scenario templating JSON schema for CI-driven load tests
- Batch publish mode to simulate network burst behavior
