---
title: racecontrol
description: Component diagram for the RaceControl Service.
---

## RaceControl Service â€” Components

<Diagram lang="mermaid" chart={`
flowchart TD
  %% ============================================
  %% RaceControl Service Components (.NET)
  %% ============================================

  subgraph RC["ðŸ RaceControl Service (.NET)"]
    direction TB

    subgraph Inputs["ðŸ“¥ Inputs"]
      ConsEnriched["Kafka Consumer\nenriched.v1 (telemetry)"]
      ExtFeed["External Feed\nflags/weather/position"]
    end

    subgraph Logic["ðŸ§  Decision & Commands"]
      Rules["Rules Engine\nSC/VSC logic, penalties"]
      Strategy["Strategy Helper\npit window, tyre mgmt"]
      Validator["Command Validator\nRBAC + consistency"]
    end

    subgraph Outputs["ðŸ“¤ Outputs"]
      CmdTopic["Kafka Producer\nracecontrol.commands.v1"]
      DirectorAPI["Race Director API\nfor UI controls"]
      RTNotify["Realtime Notify\nstatus updates"]
    end

    subgraph Guard["ðŸ›¡ï¸ Resilience & Obs"]
      Rate["Rate Limiter"]
      CB["Circuit Breakers\nKafka/RT/HTTP"]
      Metrics["Prometheus"]
      Logs["Serilog â†’ Loki"]
      Health["/health, /ready"]
    end
  end

  Kafka["ðŸ”€ Kafka (infra)"]
  RT["âš¡ Realtime Gateway"]
  UI["ðŸ–¥ï¸ Frontend"]
  Auth["ðŸ” Auth Service"]

  %% Flows
  Kafka --> ConsEnriched
  ExtFeed --> Rules
  ConsEnriched --> Strategy --> Rules --> Validator

  Validator --> CmdTopic --> Kafka
  Validator --> DirectorAPI --> UI
  Validator --> RTNotify --> RT

  UI -->|"commands"| DirectorAPI
  DirectorAPI -->|"validate RBAC"| Auth

  %% Observability
  Rules -.-> Metrics
  DirectorAPI -.-> Metrics
  Health -.-> Kafka

  %% Styling
  classDef dotnet fill:#8b5cf6,stroke:#5b21b6,color:#ffffff;
  classDef resilience fill:#ef4444,stroke:#dc2626,color:#ffffff;
  classDef infra fill:#374151,stroke:#111827,color:#ffffff;
  classDef external fill:#6b7280,stroke:#374151,color:#ffffff;

  class RC,Inputs,Logic,Outputs,Guard,Rate,CB,Metrics,Logs,Health,Rules,Strategy,Validator,CmdTopic,DirectorAPI,RTNotify dotnet;
  class Kafka infra;
  class RT,UI,Auth external;

  `} />

Notes: single place for race-director commands; produces commands back to Kafka for downstream processing and archiving.
