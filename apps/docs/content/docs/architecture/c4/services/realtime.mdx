---
title: realtime
description: Component diagram for the Realtime Gateway (Centrifugo).
---

## Realtime Gateway â€” Components

<Diagram lang="mermaid" chart={`
flowchart TD
  %% ============================================
  %% Realtime Gateway (WS/SSE) Components
  %% ============================================

  subgraph RT["âš¡ Realtime Gateway (Go / Centrifugo)"]
    direction TB

    subgraph Inbound["ðŸ“¥ Kafka Consumers"]
      ConsEnriched["Consumer\ntelemetry.enriched.v1"]
      ConsCompact["Consumer\noptional compact DTOs"]
    end

    subgraph Fanout["ðŸ“¡ Broadcast Engine"]
      ChannelMap["Channel Router\ncarId/session â†’ channel"]
      PubHub["Publisher\nWebSocket/SSE"]
      Presence["Presence & Subscriptions\nper-connection state"]
    end

    subgraph CacheLayer["ðŸ§  Hot Cache"]
      ReadCache["Redis Read-Through\nlatest values"]
      Backfill["On-join Backfill\nsnapshot push"]
    end

    subgraph Guard["ðŸ›¡ï¸ Access & Limits"]
      JWT["JWT Validator\nAuth Service introspection"]
      Rate["Rate Limiter\nconn/msg quotas"]
      CB["Circuit Breakers\nRedis/Kafka/Web"]
    end

    subgraph Obs["ðŸ“Š Observability"]
      Metrics["Prometheus metrics\nconn count, fanout, lag"]
      Logs["Structured logs\nLoki"]
      Health["/health, /ready"]
    end
  end

  Kafka["ðŸ”€ Kafka Cluster (infra)"]
  Redis["âš¡ Redis (infra)"]
  Auth["ðŸ” Auth Service (.NET)"]
  UI["ðŸ–¥ï¸ Frontend (React)"]

  %% Flows
  Kafka -->|"consume enriched"| ConsEnriched
  Kafka -->|"consume compact"| ConsCompact

  ConsEnriched --> ChannelMap
  ConsCompact --> ChannelMap

  ChannelMap --> PubHub
  ReadCache -.->|"get latest"| PubHub
  PubHub -->|"to clients"| UI

  UI -->|"connect\nWS/SSE"| PubHub
  UI -->|"JWT tokens"| JWT
  JWT --> Auth

  PubHub -->|"snapshot on join"| Backfill
  Backfill --> ReadCache

  PubHub --> Rate
  Rate --> CB
  CB -.->|"state changes"| Metrics

  %% Observability
  PubHub -.-> Metrics
  ChannelMap -.-> Metrics
  Health -.-> Redis
  Health -.-> Kafka

  %% Styling
  classDef go fill:#0ea5e9,stroke:#0369a1,color:#ffffff;
  classDef resilience fill:#ef4444,stroke:#dc2626,color:#ffffff;
  classDef infra fill:#374151,stroke:#111827,color:#ffffff;
  classDef external fill:#6b7280,stroke:#374151,color:#ffffff;

  class RT,Inbound,Fanout,Presence,ChannelMap,PubHub,CacheLayer,ReadCache,Backfill,Guard,JWT,Rate,CB,Obs,Metrics,Logs,Health go;
  class Kafka,Redis infra;
  class Auth,UI external;

  `} />

Notes: stateless, horizontally scalable; relies on Redis for presence and short-term cache.
