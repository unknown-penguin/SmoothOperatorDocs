@startuml
!theme plain
skinparam linetype ortho

package "Browser" {
  [User] as User
}

package "Docker Compose" {

  package "docs (Next.js 15 + Fumadocs)" {
    component "App Router" as Router
    component "React Components" as Components {
      [Mermaid]
      [Diagram]
      [DiagramModal]
    }
    component "/api/diagram" as API
    database "diagrams/" as Files {
      [*.puml]
      [*.dot]
    }
    database "content/docs/" as Content {
      [*.mdx]
    }
  }

  package "kroki" {
    [Kroki Service\nPort 8000] as Kroki
  }
}

User --> Router : "HTTPS :3000"
Router --> Content : "Read MDX"
Router --> Components : "Render"
Components --> API : "Fetch diagram"
API --> Files : "fs.readFile()"
API --> Kroki : "POST\ndiagram text"
Kroki --> API : "SVG/PNG"
API --> Components : "Image"
Components --> User : "Display +\nZoom Modal"

note right of Mermaid
  Client-side
  Theme-aware
  Cached
end note

note right of API
  Runtime: nodejs
  Security:
  - Path validation
  - Size limits
  - Language allowlist
end note

note bottom of Kroki
  Official image
  Supports 20+ formats:
  - PlantUML
  - Graphviz
  - Mermaid
  - C4
  - etc.
end note

@enduml
